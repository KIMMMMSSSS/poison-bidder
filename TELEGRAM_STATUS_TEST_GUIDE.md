# 텔레그램 봇 상태 추적 시스템 테스트 가이드

## 개요
이 문서는 텔레그램 봇의 실시간 상태 추적 시스템을 테스트하는 방법을 안내합니다.

## 구현된 기능
1. **실시간 상태 추적**: 각 작업 단계별로 실제 진행 상황을 추적
2. **상태 코드 표준화**: 9개의 표준 상태 코드 사용
3. **진행률 계산**: 각 단계별 가중치 기반 진행률 계산
4. **콜백 메커니즘**: 모든 모듈 간 일관된 콜백 인터페이스
5. **오류 처리**: 오류 발생 시 ERROR 상태로 전환

## 테스트 방법

### 1. 단위 테스트 실행
```bash
python test_telegram_status.py
```

### 2. 실제 텔레그램 봇 테스트

#### 봇 실행
```bash
python telegram_bot.py
```

#### 텔레그램에서 테스트
1. 봇에게 `/start` 명령 전송
2. `/auto 나이키` 명령으로 자동 입찰 시작
3. 다음 상태 메시지들이 순서대로 표시되는지 확인:
   - 🚀 초기화
   - 🔐 로그인 확인
   - 🔍 키워드 검색
   - 🔗 링크 추출
   - 📦 스크래핑
   - 💰 가격 계산
   - 🎯 입찰 진행
   - ✅ 완료

### 3. 오류 시나리오 테스트

#### 네트워크 오류 시뮬레이션
1. 인터넷 연결을 끊고 봇 실행
2. `/auto` 명령 실행
3. ❌ ERROR 상태 메시지가 표시되는지 확인

#### 로그인 실패 테스트
1. 잘못된 로그인 정보로 설정
2. `/auto musinsa 테스트` 실행
3. 로그인 실패 메시지가 표시되는지 확인

## 예상 결과

### 정상 작동 시
```
🚀 **진행 상황**

[██████████] 100%

🔄 현재 단계: COMPLETED
📝 모든 작업이 완료되었습니다!
```

### 오류 발생 시
```
❌ **진행 상황**

[░░░░░░░░░░] 0%

🔄 현재 단계: ERROR
📝 오류 발생: Connection timeout
❗ 오류: Connection timeout
```

## 로그 확인
- 로그 파일 위치: `C:\poison_final\logs\`
- 텔레그램 봇 로그: `telegram_bot_YYYYMMDD.log`
- 자동 입찰 로그: `auto_bidding_YYYYMMDD.log`
- 포이즌 통합 로그: `poison_integrated_YYYYMMDD.log`

## 문제 해결

### 콜백이 호출되지 않는 경우
1. `status_constants.py`가 올바르게 import되었는지 확인
2. 각 모듈에서 `status_callback` 파라미터를 전달하는지 확인
3. 로그 파일에서 오류 메시지 확인

### 진행률이 올바르지 않은 경우
1. `STAGE_PROGRESS_RANGES`의 범위가 올바른지 확인
2. `calculate_stage_progress` 함수의 계산 로직 확인

### 메시지가 너무 자주/적게 오는 경우
1. `PROGRESS_UPDATE_THRESHOLD` 값 조정 (기본값: 5%)
2. `TELEGRAM_MESSAGE_MIN_INTERVAL` 값 조정 (기본값: 1/30초)

## 성능 최적화
- 진행률 변경이 5% 이상일 때만 메시지 전송
- 텔레그램 API 제한 준수 (초당 30회)
- Queue를 통한 비동기 메시지 처리

## 추가 개발 제안
1. 웹 대시보드 연동
2. 진행 상황 로그 데이터베이스 저장
3. 통계 및 분석 기능 추가
4. 다국어 지원
